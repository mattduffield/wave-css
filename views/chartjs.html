<!DOCTYPE html>
<html lang="en" class="theme-ocean">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WC-ChartJS Examples</title>
  <link rel="stylesheet" href="../dist/wave-css.min.css">
</head>
<body class="bg-gray-50 dark:bg-gray-900">
  <style>
    .chart-container {
      margin-bottom: 2rem;
      padding: 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
  </style>

  <div id="page-contents">
    <div class="flex flex-col flex-1 p-6 gap-4">
      <header class="mb-8">
        <h1 class="text-4xl font-bold mb-2">WC-ChartJS Component Examples</h1>
        <p class="text-gray-600 dark:text-gray-400">Dynamic charts that fetch data from AJAX endpoints</p>
      </header>

      <wc-theme-selector class="mb-4"></wc-theme-selector>

      <!-- Example 1: Basic AJAX Chart -->
      <section class="container p-4 rounded-md">
        <h2 class="text-2xl font-semibold mb-4">Example 1: Basic AJAX Chart</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-4">
          This chart fetches data from a URL endpoint. The endpoint should return JSON with labels and datasets.
        </p>
        <wc-chartjs
          id="ajaxChart1"
          url="/api/chart-data/sales"
          type="bar"
          height="400"
          show-legend="true"
          legend-position="top"
          loading-text="Loading sales data...">
        </wc-chartjs>
      </section>

      <!-- Example 2: Chart with Query Parameters -->
      <section class="container p-4 rounded-md">
        <h2 class="text-2xl font-semibold mb-4">Example 2: Chart with Dynamic Parameters</h2>
        <div class="mb-4 flex gap-2">
          <button id="btnDays7" class="btn btn-sm btn-primary">Last 7 Days</button>
          <button id="btnDays14" class="btn btn-sm btn-secondary">Last 14 Days</button>
          <button id="btnDays30" class="btn btn-sm btn-info">Last 30 Days</button>
        </div>
        <wc-chartjs
          id="ajaxChart2"
          url="/api/prospect-quotes/chart-data"
          url-params='{"num_days": "14", "quote_state": ""}'
          type="bar"
          height="500"
          show-legend="true"
          legend-position="top"
          y-axis-title="Number of Quotes"
          x-axis-title="Date">
        </wc-chartjs>
      </section>

      <!-- Example 3: Auto-Refresh Chart -->
      <section class="container p-4 rounded-md">
        <h2 class="text-2xl font-semibold mb-4">Example 3: Auto-Refresh Chart</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-4">
          This chart automatically refreshes every 30 seconds (30000ms).
        </p>
        <wc-chartjs
          id="ajaxChart3"
          url="/api/chart-data/realtime"
          type="line"
          height="350"
          auto-refresh="30000"
          show-legend="true"
          tension="0.3">
        </wc-chartjs>
      </section>

      <!-- Example 4: Pie Chart from API -->
      <section class="container p-4 rounded-md">
        <h2 class="text-2xl font-semibold mb-4">Example 4: Pie Chart from API</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <wc-chartjs
            url="/api/chart-data/market-share"
            type="pie"
            height="350"
            legend-position="right">
          </wc-chartjs>
          <wc-chartjs
            url="/api/chart-data/budget"
            type="doughnut"
            height="350"
            legend-position="right">
          </wc-chartjs>
        </div>
      </section>

      <!-- Example 5: Stacked Bar Chart -->
      <section class="container p-4 rounded-md">
        <h2 class="text-2xl font-semibold mb-4">Example 5: Stacked Chart with Custom Headers</h2>
        <wc-chartjs
          url="/api/chart-data/device-usage"
          ajax-headers='{"Authorization": "Bearer token123", "Custom-Header": "value"}'
          type="bar"
          stacked="true"
          height="400"
          show-legend="true">
        </wc-chartjs>
      </section>

      <!-- Example 6: Fallback to Static Data -->
      <section class="container p-4 rounded-md">
        <h2 class="text-2xl font-semibold mb-4">Example 6: Static Data (No AJAX)</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-4">
          When no url is provided, wc-chartjs works exactly like wc-chart with inline data.
        </p>
        <wc-chartjs
          type="line"
          labels='["January", "February", "March", "April", "May"]'
          datasets='[
            {"label": "2023", "data": [65, 59, 80, 81, 56]},
            {"label": "2024", "data": [85, 79, 100, 101, 76]}
          ]'
          title="Static Line Chart"
          height="300"
          tension="0.4">
        </wc-chartjs>
      </section>

      <!-- Example 7: Manual Reload -->
      <section class="container p-4 rounded-md">
        <h2 class="text-2xl font-semibold mb-4">Example 7: Manual Reload Control</h2>
        <div class="mb-4 flex gap-2">
          <button id="btnReload" class="btn btn-primary">Reload Chart</button>
          <button id="btnChangeUrl" class="btn btn-secondary">Change Data Source</button>
        </div>
        <wc-chartjs
          id="manualChart"
          url="/api/chart-data/manual"
          type="bar"
          height="350"
          show-data-labels="true">
        </wc-chartjs>
      </section>

      <!-- Example 8: Busy Indicators -->
      <section class="container p-4 rounded-md">
        <h2 class="text-2xl font-semibold mb-4">Example 8: Busy Indicator Styles</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-4">
          Different busy indicator animations you can use with the <code>busy-indicator-type</code> attribute.
        </p>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
          <div class="flex flex-col items-center p-4 border rounded">
            <h3 class="text-lg font-semibold mb-2">chart-bar</h3>
            <wc-busy-indicator type="chart-bar" size="medium" text="Loading..."></wc-busy-indicator>
            <p class="text-xs text-gray-500 mt-2">With color variations (default)</p>
          </div>
          <div class="flex flex-col items-center p-4 border rounded">
            <h3 class="text-lg font-semibold mb-2">chart-line</h3>
            <wc-busy-indicator type="chart-line" size="medium" text="Loading..."></wc-busy-indicator>
            <p class="text-xs text-gray-500 mt-2">Animated line graph with dots</p>
          </div>
          <div class="flex flex-col items-center p-4 border rounded">
            <h3 class="text-lg font-semibold mb-2">chart-ecg</h3>
            <wc-busy-indicator type="chart-ecg" size="medium" text="Loading..."></wc-busy-indicator>
            <p class="text-xs text-gray-500 mt-2">Heartbeat monitor style</p>
          </div>
          <div class="flex flex-col items-center p-4 border rounded">
            <h3 class="text-lg font-semibold mb-2">horizontal-bar</h3>
            <wc-busy-indicator type="horizontal-bar" size="medium" text="Loading..."></wc-busy-indicator>
            <p class="text-xs text-gray-500 mt-2">Parallax scrolling bars</p>
          </div>
          <div class="flex flex-col items-center p-4 border rounded">
            <h3 class="text-lg font-semibold mb-2">chart-doughnut</h3>
            <wc-busy-indicator type="chart-doughnut" size="medium" text="Loading..."></wc-busy-indicator>
            <p class="text-xs text-gray-500 mt-2">With color variations (default)</p>
          </div>
          <div class="flex flex-col items-center p-4 border rounded">
            <h3 class="text-lg font-semibold mb-2">spinner</h3>
            <wc-busy-indicator type="spinner" size="medium" text="Loading..."></wc-busy-indicator>
            <p class="text-xs text-gray-500 mt-2">Classic spinner</p>
          </div>
          <div class="flex flex-col items-center p-4 border rounded">
            <h3 class="text-lg font-semibold mb-2">pulse</h3>
            <wc-busy-indicator type="pulse" size="medium" text="Loading..."></wc-busy-indicator>
            <p class="text-xs text-gray-500 mt-2">Pulsing circle</p>
          </div>
        </div>

        <h3 class="text-xl font-semibold mb-4">Color Variation Modes</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-4">
          Use the <code>color-variation</code> attribute to control color display: "standard" (strong visible differences using --surface-x), "subtle" (HSL adjustments), or "off" (single color). chart-bar, chart-pie, and chart-doughnut default to "standard".
        </p>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="flex flex-col items-center p-4 border rounded">
            <h4 class="text-md font-semibold mb-2">standard (default)</h4>
            <wc-busy-indicator type="chart-bar" color-variation="standard" size="medium"></wc-busy-indicator>
            <p class="text-xs text-gray-500 mt-2">Uses --surface-4,6,7,8,10</p>
          </div>
          <div class="flex flex-col items-center p-4 border rounded">
            <h4 class="text-md font-semibold mb-2">subtle</h4>
            <wc-busy-indicator type="chart-bar" color-variation="subtle" size="medium"></wc-busy-indicator>
            <p class="text-xs text-gray-500 mt-2">HSL lightness adjustments</p>
          </div>
          <div class="flex flex-col items-center p-4 border rounded">
            <h4 class="text-md font-semibold mb-2">off</h4>
            <wc-busy-indicator type="chart-bar" color-variation="off" size="medium"></wc-busy-indicator>
            <p class="text-xs text-gray-500 mt-2">Single color</p>
          </div>
        </div>

        <h3 class="text-xl font-semibold mb-4 mt-8">Custom Color Levels</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-4">
          Use <code>color-levels</code> to customize which --surface-x variables are used (default: "4,6,7,8,10").
        </p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="flex flex-col items-center p-4 border rounded">
            <h4 class="text-md font-semibold mb-2">Default levels (4,6,7,8,10)</h4>
            <wc-busy-indicator type="chart-doughnut" color-variation="standard" size="medium"></wc-busy-indicator>
          </div>
          <div class="flex flex-col items-center p-4 border rounded">
            <h4 class="text-md font-semibold mb-2">Custom levels (2,5,8,11)</h4>
            <wc-busy-indicator type="chart-doughnut" color-variation="standard" color-levels="2,5,8,11" size="medium"></wc-busy-indicator>
          </div>
        </div>
      </section>

      <!-- Example 9: wc-chartjs with Busy Indicator Color Control -->
      <section class="container p-4 rounded-md">
        <h2 class="text-2xl font-semibold mb-4">Example 9: Control Busy Indicator Colors from wc-chartjs</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-4">
          Use <code>busy-color-variation</code> and <code>busy-color-levels</code> to control the loading indicator appearance.
        </p>

        <h3 class="text-lg font-semibold mb-2">Standard Mode (default)</h3>
        <wc-chartjs
          url="/api/chart-data/demo1"
          type="bar"
          height="300"
          busy-indicator="true"
          busy-indicator-type="chart-bar"
          busy-color-variation="standard"
          loading-text="Loading with standard colors...">
        </wc-chartjs>

        <h3 class="text-lg font-semibold mb-2 mt-6">Subtle Color Variations</h3>
        <wc-chartjs
          url="/api/chart-data/demo2"
          type="pie"
          height="300"
          busy-indicator="true"
          busy-indicator-type="chart-pie"
          busy-color-variation="subtle"
          loading-text="Loading with subtle colors...">
        </wc-chartjs>

        <h3 class="text-lg font-semibold mb-2 mt-6">Single Color (off)</h3>
        <wc-chartjs
          url="/api/chart-data/demo3"
          type="doughnut"
          height="300"
          busy-indicator="true"
          busy-indicator-type="chart-doughnut"
          busy-color-variation="off"
          loading-text="Loading with single color...">
        </wc-chartjs>

        <h3 class="text-lg font-semibold mb-2 mt-6">Custom Color Levels</h3>
        <wc-chartjs
          url="/api/chart-data/demo4"
          type="bar"
          height="300"
          busy-indicator="true"
          busy-indicator-type="chart-bar"
          busy-color-variation="standard"
          busy-color-levels="3,5,7,9,11"
          loading-text="Loading with custom surface levels...">
        </wc-chartjs>
      </section>

      <!-- API Documentation -->
      <section class="container p-4 rounded-md">
        <h2 class="text-2xl font-semibold mb-4">API Response Format</h2>
        <p class="mb-4">Your API endpoint should return JSON in this format:</p>
        <pre class="bg-gray-800 text-green-400 p-4 rounded overflow-x-auto"><code>{
  "labels": ["Q1", "Q2", "Q3", "Q4"],
  "datasets": [
    {
      "label": "2023 Sales",
      "data": [120, 150, 180, 220],
      "backgroundColor": "#E57373",
      "borderColor": "#F44336",
      "borderWidth": 1
    },
    {
      "label": "2024 Sales",
      "data": [180, 220, 260, 320],
      "backgroundColor": "#64B5F6",
      "borderColor": "#2196F3",
      "borderWidth": 1
    }
  ],
  "title": "Quarterly Sales Comparison",  // Optional
  "type": "bar",                          // Optional
  "showLegend": true,                     // Optional
  "legendPosition": "top",                // Optional
  "xAxisTitle": "Quarter",                // Optional
  "yAxisTitle": "Revenue ($K)"            // Optional
}</code></pre>
      </section>

      <!-- Events Documentation -->
      <section class="container p-4 rounded-md">
        <h2 class="text-2xl font-semibold mb-4">Events</h2>
        <div id="eventLog" class="bg-gray-100 dark:bg-gray-800 p-4 rounded h-32 overflow-y-auto font-mono text-sm">
          <div class="text-gray-500">Event log will appear here...</div>
        </div>
      </section>
    </div>
  </div>

  <script type="module" src="../dist/wave-css.min.js"></script>
  <script>
    // Wait for components to be ready
    document.addEventListener('DOMContentLoaded', () => {
      const eventLog = document.getElementById('eventLog');

      // Log events from all charts
      document.addEventListener('chartjs:loading', (e) => {
        logEvent('ðŸ”„ Loading', e.detail);
      });

      document.addEventListener('chartjs:loaded', (e) => {
        logEvent('âœ… Loaded', e.detail);
      });

      document.addEventListener('chartjs:error', (e) => {
        logEvent('âŒ Error', e.detail);
      });

      function logEvent(type, detail) {
        const entry = document.createElement('div');
        entry.className = 'mb-1';
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${type}: ${JSON.stringify(detail)}`;
        eventLog.appendChild(entry);
        eventLog.scrollTop = eventLog.scrollHeight;
      }

      // Example 2: Dynamic parameters
      const chart2 = document.getElementById('ajaxChart2');
      document.getElementById('btnDays7')?.addEventListener('click', () => {
        chart2.setParams({ num_days: "7", quote_state: "" });
      });
      document.getElementById('btnDays14')?.addEventListener('click', () => {
        chart2.setParams({ num_days: "14", quote_state: "" });
      });
      document.getElementById('btnDays30')?.addEventListener('click', () => {
        chart2.setParams({ num_days: "30", quote_state: "" });
      });

      // Example 7: Manual reload
      const manualChart = document.getElementById('manualChart');
      document.getElementById('btnReload')?.addEventListener('click', () => {
        manualChart.reload();
      });
      document.getElementById('btnChangeUrl')?.addEventListener('click', () => {
        manualChart.setUrl('/api/chart-data/alternative');
      });
    });

    // Mock API endpoints for demo purposes
    // In production, remove this and use real backend endpoints
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      // Intercept fetch calls for demo
      const originalFetch = window.fetch;
      window.fetch = function(...args) {
        const url = args[0];

        // Mock responses for different endpoints
        if (url.includes('/api/chart-data/sales')) {
          return Promise.resolve({
            ok: true,
            json: () => Promise.resolve({
              labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
              datasets: [{
                label: 'Monthly Sales',
                data: [65, 59, 80, 81, 56, 55],
                backgroundColor: '#64B5F6',
                borderColor: '#2196F3',
                borderWidth: 2
              }],
              title: 'Monthly Sales 2024',
              yAxisTitle: 'Sales ($K)'
            })
          });
        }

        if (url.includes('/api/prospect-quotes/chart-data')) {
          const urlObj = new URL(url, window.location.origin);
          const numDays = urlObj.searchParams.get('num_days') || '14';

          return Promise.resolve({
            ok: true,
            json: () => Promise.resolve({
              labels: ['2024-01-01 (15)', '2024-01-02 (23)', '2024-01-03 (18)', '2024-01-04 (25)'],
              datasets: [
                {
                  label: 'Agent Smith',
                  data: [8, 12, 10, 15],
                  backgroundColor: '#E57373',
                  borderColor: '#F44336',
                  borderWidth: 1
                },
                {
                  label: 'Agent Jones',
                  data: [7, 11, 8, 10],
                  backgroundColor: '#64B5F6',
                  borderColor: '#2196F3',
                  borderWidth: 1
                }
              ],
              title: `Prospect Quotes (Last ${numDays} days)`,
              type: 'bar'
            })
          });
        }

        if (url.includes('/api/chart-data/realtime')) {
          const randomData = () => Math.floor(Math.random() * 50) + 20;
          return Promise.resolve({
            ok: true,
            json: () => Promise.resolve({
              labels: ['Now-5m', 'Now-4m', 'Now-3m', 'Now-2m', 'Now-1m', 'Now'],
              datasets: [{
                label: 'Real-time Data',
                data: [randomData(), randomData(), randomData(), randomData(), randomData(), randomData()],
                backgroundColor: '#4DB6AC',
                borderColor: '#009688',
                borderWidth: 2
              }],
              title: 'Real-time Monitoring'
            })
          });
        }

        if (url.includes('/api/chart-data/market-share')) {
          return Promise.resolve({
            ok: true,
            json: () => Promise.resolve({
              labels: ['Product A', 'Product B', 'Product C', 'Product D'],
              datasets: [{
                label: 'Market Share',
                data: [30, 25, 20, 25]
              }],
              title: 'Market Share Distribution'
            })
          });
        }

        if (url.includes('/api/chart-data/budget')) {
          return Promise.resolve({
            ok: true,
            json: () => Promise.resolve({
              labels: ['Marketing', 'Development', 'Operations', 'Sales'],
              datasets: [{
                label: 'Budget',
                data: [25000, 45000, 20000, 30000]
              }],
              title: 'Budget Allocation'
            })
          });
        }

        // Demo endpoints for Example 9 (busy indicator color control)
        if (url.includes('/api/chart-data/demo')) {
          // Simulate slow loading to see the busy indicator
          return new Promise(resolve => {
            setTimeout(() => {
              resolve({
                ok: true,
                json: () => Promise.resolve({
                  labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                  datasets: [{
                    label: 'Sales 2024',
                    data: [120, 150, 180, 220],
                    backgroundColor: '#64B5F6',
                    borderColor: '#2196F3',
                    borderWidth: 2
                  }],
                  title: 'Quarterly Sales'
                })
              });
            }, 3000); // 3 second delay to see busy indicator
          });
        }

        // Fallback for other endpoints
        return originalFetch.apply(this, args);
      };
    }
  </script>
</body>
</html>
